<!--<template>-->
<!--  <div class="send-notification-container">-->
<!--    <h1 class="title">ğŸ“© å‘é€æ–°é€šçŸ¥</h1>-->
<!--    <form @submit.prevent="sendNotification" class="notification-form">-->
<!--      <div class="form-group">-->
<!--        <label class="form-label" for="studentId">å­¦ç”ŸID</label>-->
<!--        <input-->
<!--          type="text"-->
<!--          v-model="studentId"-->
<!--          required-->
<!--          class="form-input"-->
<!--          id="studentId"-->
<!--        />-->
<!--      </div>-->

<!--      <div class="form-group">-->
<!--        <label class="form-label" for="message">æ¶ˆæ¯å†…å®¹</label>-->
<!--        <textarea-->
<!--          v-model="message"-->
<!--          required-->
<!--          class="form-textarea"-->
<!--          id="message"-->
<!--          rows="4"-->
<!--        ></textarea>-->
<!--      </div>-->

<!--      <button type="submit" class="submit-btn">-->
<!--        <span class="btn-text">å‘é€é€šçŸ¥</span>-->
<!--        <span class="btn-icon">â”</span>-->
<!--      </button>-->
<!--    </form>-->
<!--  </div>-->
<!--</template>-->


<!--<script>-->
<!--import { ref } from 'vue';-->
<!--import axios from 'axios';-->

<!--export default {-->
<!--  setup() {-->
<!--    const studentId = ref('');-->
<!--    const message = ref('');-->

<!--    const sendNotification = async () => {-->
<!--      try {-->
<!--        await axios.post('http://localhost:8002/interact/send-notification/', {-->
<!--          student_id: studentId.value,-->
<!--          message: message.value-->
<!--        });-->
<!--        alert('é€šçŸ¥å‘é€æˆåŠŸ');-->
<!--        studentId.value = '';-->
<!--        message.value = '';-->
<!--      } catch (error) {-->
<!--        console.error('å‘é€é€šçŸ¥å¤±è´¥:', error);-->
<!--        alert('å‘é€é€šçŸ¥å¤±è´¥');-->
<!--      }-->
<!--    };-->

<!--    return {-->
<!--      studentId,-->
<!--      message,-->
<!--      sendNotification,-->
<!--    };-->
<!--  },-->
<!--};-->
<!--</script>-->


<!--<style scoped>-->
<!--.send-notification-container {-->
<!--  max-width: 600px;-->
<!--  margin: 2rem auto;-->
<!--  padding: 2rem;-->
<!--  background: #fff;-->
<!--  border-radius: 15px;-->
<!--  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);-->
<!--}-->

<!--.title {-->
<!--  color: #2c3e50;-->
<!--  text-align: center;-->
<!--  margin-bottom: 2.5rem;-->
<!--  font-size: 2.2rem;-->
<!--  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);-->
<!--}-->

<!--.notification-form {-->
<!--  display: flex;-->
<!--  flex-direction: column;-->
<!--  gap: 1.5rem;-->
<!--}-->

<!--.form-group {-->
<!--  display: flex;-->
<!--  flex-direction: column;-->
<!--  gap: 0.5rem;-->
<!--}-->

<!--.form-label {-->
<!--  color: #34495e;-->
<!--  font-weight: 500;-->
<!--  font-size: 1.1rem;-->
<!--}-->

<!--.form-input,-->
<!--.form-textarea {-->
<!--  padding: 0.8rem 1rem;-->
<!--  border: 2px solid #e0e0e0;-->
<!--  border-radius: 8px;-->
<!--  font-size: 1rem;-->
<!--  transition: border-color 0.3s ease;-->
<!--}-->

<!--.form-input:focus,-->
<!--.form-textarea:focus {-->
<!--  border-color: #42b983;-->
<!--  outline: none;-->
<!--  box-shadow: 0 0 0 3px rgba(66, 185, 131, 0.1);-->
<!--}-->

<!--.form-textarea {-->
<!--  resize: vertical;-->
<!--  min-height: 100px;-->
<!--}-->

<!--.submit-btn {-->
<!--  background: #42b983;-->
<!--  color: white;-->
<!--  border: none;-->
<!--  padding: 1rem 2rem;-->
<!--  border-radius: 25px;-->
<!--  cursor: pointer;-->
<!--  transition: all 0.3s ease;-->
<!--  display: flex;-->
<!--  align-items: center;-->
<!--  gap: 0.8rem;-->
<!--  font-weight: 600;-->
<!--  justify-content: center;-->
<!--}-->

<!--.submit-btn:hover {-->
<!--  background: #33a06f;-->
<!--  transform: translateY(-2px);-->
<!--  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);-->
<!--}-->

<!--.submit-btn:active {-->
<!--  transform: translateY(0);-->
<!--}-->

<!--.btn-icon {-->
<!--  font-size: 1.2rem;-->
<!--  transition: transform 0.3s ease;-->
<!--}-->

<!--.submit-btn:hover .btn-icon {-->
<!--  transform: translateX(3px);-->
<!--}-->

<!--/* å“åº”å¼è®¾è®¡ */-->
<!--@media (max-width: 480px) {-->
<!--  .send-notification-container {-->
<!--    margin: 1rem;-->
<!--    padding: 1.5rem;-->
<!--  }-->

<!--  .title {-->
<!--    font-size: 1.8rem;-->
<!--    margin-bottom: 1.5rem;-->
<!--  }-->

<!--  .form-input,-->
<!--  .form-textarea {-->
<!--    padding: 0.6rem 0.8rem;-->
<!--    font-size: 0.9rem;-->
<!--  }-->

<!--  .submit-btn {-->
<!--    padding: 0.8rem 1.5rem;-->
<!--    font-size: 0.9rem;-->
<!--    gap: 0.5rem;-->
<!--  }-->
<!--}-->
<!--</style>-->



<!--<template>-->
<!--  <div class="send-notification-container">-->
<!--    <h1 class="title">ğŸ“© æ‰¹é‡å‘é€é€šçŸ¥</h1>-->

<!--    &lt;!&ndash; æ–°å¢å­¦ç”Ÿåˆ—è¡¨åŒºåŸŸ &ndash;&gt;-->
<!--    <div class="student-list-wrapper">-->
<!--      <el-input-->
<!--        placeholder="è¾“å…¥å­¦ç”Ÿç¼–å·/å§“åç­›é€‰..."-->
<!--        v-model="queryForm.query"-->
<!--        clearable-->
<!--        style="width: 300px; margin-bottom: 15px"-->
<!--      />-->

<!--      <el-table-->
<!--        :data="tableData"-->
<!--        @selection-change="handleSelectionChange"-->
<!--        height="300"-->
<!--        style="width: 100%"-->
<!--      >-->
<!--        &lt;!&ndash; æ·»åŠ å¤šé€‰åˆ— &ndash;&gt;-->
<!--        <el-table-column type="selection" width="55" />-->
<!--        <el-table-column prop="student_id" label="å­¦å·" width="120" />-->
<!--        <el-table-column prop="student_name" label="å§“å" width="120" />-->
<!--        <el-table-column prop="school" label="å­¦æ ¡" />-->
<!--      </el-table>-->
<!--    </div>-->

<!--    <form @submit.prevent="sendNotification" class="notification-form">-->
<!--      <div class="form-group">-->
<!--        <label class="form-label">æ¶ˆæ¯å†…å®¹</label>-->
<!--        <textarea-->
<!--          v-model="message"-->
<!--          required-->
<!--          class="form-textarea"-->
<!--          rows="4"-->
<!--          placeholder="è¯·è¾“å…¥é€šçŸ¥å†…å®¹..."-->
<!--        ></textarea>-->
<!--      </div>-->

<!--      <button type="submit" class="submit-btn">-->
<!--        <span class="btn-text">å‘é€é€šçŸ¥</span>-->
<!--        <span class="btn-icon">â”</span>-->
<!--      </button>-->

<!--      &lt;!&ndash; æ–°å¢å‘é€çŠ¶æ€æç¤º &ndash;&gt;-->
<!--      <div v-if="sendStatus" class="status-indicator">-->
<!--        {{ sendStatus }}-->
<!--      </div>-->
<!--    </form>-->
<!--  </div>-->
<!--</template>-->

<!--<script setup>-->
<!--import { ref } from 'vue';-->
<!--import axios from 'axios';-->
<!--import { ElMessage } from 'element-plus';-->

<!--// å¤ç”¨å­¦ç”Ÿåˆ—è¡¨é€»è¾‘-->
<!--const queryForm = ref({-->
<!--  query: '',-->
<!--  pageNum: 1,-->
<!--  pageSize: 10-->
<!--});-->

<!--const total = ref(0);-->
<!--const tableData = ref([]);-->
<!--const multipleSelection = ref([]);-->

<!--// åŠ è½½å­¦ç”Ÿåˆ—è¡¨-->
<!--const loadStudents = async () => {-->
<!--  try {-->
<!--    const res = await axios.post('http://localhost:8000/permission/search', queryForm.value);-->
<!--    tableData.value = res.data.roleList;-->
<!--    total.value = res.data.total;-->
<!--  } catch (error) {-->
<!--    ElMessage.error('åŠ è½½å­¦ç”Ÿåˆ—è¡¨å¤±è´¥');-->
<!--  }-->
<!--};-->

<!--// å¤šé€‰å¤„ç†-->
<!--const handleSelectionChange = (selection) => {-->
<!--  multipleSelection.value = selection;-->
<!--};-->

<!--// é€šçŸ¥ç›¸å…³é€»è¾‘-->
<!--const message = ref('');-->
<!--const sendStatus = ref('');-->

<!--const sendNotification = async () => {-->
<!--  if (multipleSelection.value.length === 0) {-->
<!--    ElMessage.warning('è¯·å…ˆé€‰æ‹©æ¥æ”¶å­¦ç”Ÿ');-->
<!--    return;-->
<!--  }-->

<!--  try {-->
<!--    sendStatus.value = 'å‘é€ä¸­...';-->

<!--    // æå–é€‰ä¸­çš„å­¦ç”ŸID-->
<!--    const studentIds = multipleSelection.value.map(item => item.student_id);-->

<!--    // æ‰¹é‡å‘é€è¯·æ±‚-->
<!--    await axios.post('http://localhost:8002/interact/send-notification/', {-->
<!--      student_ids: studentIds,  // ä¿®æ”¹ä¸ºæ¥æ”¶æ•°ç»„-->
<!--      message: message.value-->
<!--    });-->

<!--    sendStatus.value = 'å‘é€æˆåŠŸï¼';-->
<!--    message.value = '';-->
<!--    multipleSelection.value = []; // æ¸…ç©ºé€‰æ‹©-->
<!--    loadStudents(); // åˆ·æ–°åˆ—è¡¨-->
<!--  } catch (error) {-->
<!--    sendStatus.value = 'å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•';-->
<!--    console.error('å‘é€é€šçŸ¥å¤±è´¥:', error);-->
<!--  } finally {-->
<!--    setTimeout(() => sendStatus.value = '', 3000); // 3ç§’åæ¸…é™¤çŠ¶æ€-->
<!--  }-->
<!--};-->

<!--// åˆå§‹åŒ–åŠ è½½-->
<!--loadStudents();-->
<!--</script>-->

<!--<style scoped>-->
<!--/* æ–°å¢æ ·å¼ */-->
<!--.student-list-wrapper {-->
<!--  margin: 20px 0;-->
<!--  border: 1px solid #ebeef5;-->
<!--  border-radius: 4px;-->
<!--  padding: 15px;-->
<!--  background: #fff;-->
<!--}-->

<!--.status-indicator {-->
<!--  margin-top: 15px;-->
<!--  color: #67c23a;-->
<!--  font-weight: bold;-->
<!--}-->

<!--/* è°ƒæ•´åŸæœ‰æ ·å¼ */-->
<!--.send-notification-container {-->
<!--  max-width: 800px;-->
<!--  margin: 2rem auto;-->
<!--  padding: 2rem;-->
<!--}-->

<!--.title {-->
<!--  color: #409eff;-->
<!--  border-bottom: 2px solid #409eff;-->
<!--  padding-bottom: 10px;-->
<!--}-->

<!--.notification-form {-->
<!--  margin-top: 25px;-->
<!--}-->

<!--.form-textarea {-->
<!--  width: 100%;-->
<!--  padding: 12px 15px;-->
<!--  border: 1px solid #dcdfe6;-->
<!--  border-radius: 4px;-->
<!--}-->

<!--.submit-btn {-->
<!--  background: #409eff;-->
<!--  color: white;-->
<!--  border: none;-->
<!--  padding: 12px 25px;-->
<!--  border-radius: 4px;-->
<!--  cursor: pointer;-->
<!--  transition: all 0.3s;-->
<!--  margin-top: 15px;-->
<!--  width: 100%;-->
<!--}-->

<!--.submit-btn:hover {-->
<!--  background: #66b1ff;-->
<!--}-->
<!--</style>-->







<template>
  <div class="send-notification-container">
    <h1 class="title">ğŸ“© å‘é€é€šçŸ¥</h1>

    <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
    <div class="mode-switch">
      <button
        @click="currentMode = 'single'"
        :class="{ active: currentMode === 'single' }"
      >
        å•å‘æ¨¡å¼
      </button>
      <button
        @click="currentMode = 'batch'"
        :class="{ active: currentMode === 'batch' }"
      >
        æ‰¹é‡æ¨¡å¼
      </button>
    </div>

    <!-- å•å‘æ¨¡å¼è¡¨å• -->
    <form v-if="currentMode === 'single'" @submit.prevent="sendNotification" class="notification-form">
      <div class="form-group">
        <label class="form-label">å­¦ç”Ÿ/æ•™å¸ˆID</label>
        <input
          type="text"
          v-model="studentId"
          required
          class="form-input"
          placeholder="è¾“å…¥å•ä¸ªID"
        />
      </div>

      <div class="form-group">
        <label class="form-label">æ¶ˆæ¯å†…å®¹</label>
        <textarea
          v-model="message"
          required
          class="form-textarea"
          rows="4"
          placeholder="è¯·è¾“å…¥é€šçŸ¥å†…å®¹..."
        ></textarea>
      </div>

      <button type="submit" class="submit-btn">
        <span class="btn-text">å‘é€é€šçŸ¥</span>
        <span class="btn-icon">â”</span>
      </button>
    </form>

    <!-- æ‰¹é‡æ¨¡å¼è¡¨å• -->
    <form v-if="currentMode === 'batch'" @submit.prevent="sendBatchNotification" class="notification-form">
      <div class="student-list-wrapper">
        <el-input
          placeholder="è¾“å…¥å­¦ç”Ÿç¼–å·/å§“åç­›é€‰..."
          v-model="queryForm.query"
          clearable
          style="width: 300px; margin-bottom: 15px"
        />

        <el-table
          :data="tableData"
          @selection-change="handleSelectionChange"
          height="300"
          style="width: 100%"
        >
          <el-table-column type="selection" width="55" />
          <el-table-column prop="student_id" label="å­¦å·" width="120" />
          <el-table-column prop="student_name" label="å§“å" width="120" />
          <el-table-column prop="school" label="å­¦æ ¡" />
        </el-table>
      </div>

      <div class="form-group">
        <label class="form-label">æ¶ˆæ¯å†…å®¹</label>
        <textarea
          v-model="message"
          required
          class="form-textarea"
          rows="4"
          placeholder="è¯·è¾“å…¥é€šçŸ¥å†…å®¹..."
        ></textarea>
      </div>

      <button type="submit" class="submit-btn">
        <span class="btn-text">æ‰¹é‡å‘é€</span>
        <span class="btn-icon">â”</span>
      </button>

      <div v-if="sendStatus" class="status-indicator">
        {{ sendStatus }}
      </div>
    </form>
  </div>
</template>

<script setup>
import { ref } from 'vue';
import axios from 'axios';
import { ElMessage } from 'element-plus';

const currentMode = ref('single'); // é»˜è®¤å•å‘æ¨¡å¼

// å•å‘æ¨¡å¼æ•°æ®
const studentId = ref('');
const message = ref('');

// æ‰¹é‡æ¨¡å¼æ•°æ®
const queryForm = ref({
  query: '',
  pageNum: 1,
  pageSize: 10
});

const total = ref(0);
const tableData = ref([]);
const multipleSelection = ref([]);
const sendStatus = ref('');

// åŠ è½½å­¦ç”Ÿåˆ—è¡¨
const loadStudents = async () => {
  try {
    const res = await axios.post('http://localhost:8000/permission/search', queryForm.value);
    tableData.value = res.data.roleList;
    total.value = res.data.total;
  } catch (error) {
    ElMessage.error('åŠ è½½å­¦ç”Ÿåˆ—è¡¨å¤±è´¥');
  }
};

// å¤šé€‰å¤„ç†
const handleSelectionChange = (selection) => {
  multipleSelection.value = selection;
};

// å‘é€é€šçŸ¥
const sendNotification = async () => {
  try {
    await axios.post('http://localhost:8002/interact/send-notification/', {
      student_id: studentId.value.trim(),
      message: message.value
    });
    ElMessage.success('é€šçŸ¥å‘é€æˆåŠŸ');
    studentId.value = '';
    message.value = '';
  } catch (error) {
    ElMessage.error('å‘é€é€šçŸ¥å¤±è´¥');
    console.error('å‘é€é€šçŸ¥å¤±è´¥:', error);
  }
};

// æ‰¹é‡å‘é€é€šçŸ¥
const sendBatchNotification = async () => {
  if (multipleSelection.value.length === 0) {
    ElMessage.warning('è¯·å…ˆé€‰æ‹©æ¥æ”¶å­¦ç”Ÿ');
    return;
  }

  try {
    sendStatus.value = 'å‘é€ä¸­...';
    const studentIds = multipleSelection.value.map(item => item.student_id);

    await axios.post('http://localhost:8002/interact/send-notification/', {
      student_ids: studentIds,
      message: message.value
    });

    sendStatus.value = `æˆåŠŸå‘é€ ${studentIds.length} æ¡é€šçŸ¥`;
    message.value = '';
    multipleSelection.value = [];
    loadStudents();
  } catch (error) {
    sendStatus.value = 'å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•';
    console.error('æ‰¹é‡å‘é€å¤±è´¥:', error);
  } finally {
    setTimeout(() => sendStatus.value = '', 3000);
  }
};

// åˆå§‹åŒ–åŠ è½½
loadStudents();
</script>

<style scoped>
.send-notification-container {
  max-width: 800px;
  margin: 2rem auto;
  padding: 2rem;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.title {
  color: #2c3e50;
  text-align: center;
  margin-bottom: 2.5rem;
  font-size: 2.2rem;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
}

.mode-switch {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin-bottom: 2rem;
}

.mode-switch button {
  padding: 0.8rem 2rem;
  border: none;
  border-radius: 25px;
  background: #e0e0e0;
  color: #333;
  cursor: pointer;
  transition: all 0.3s ease;
}

.mode-switch button.active {
  background: #42b983;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.notification-form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.form-label {
  color: #34495e;
  font-weight: 500;
  font-size: 1.1rem;
}

.form-input,
.form-textarea {
  padding: 0.8rem 1rem;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

.form-input:focus,
.form-textarea:focus {
  border-color: #42b983;
  outline: none;
  box-shadow: 0 0 0 3px rgba(66, 185, 131, 0.1);
}

.form-textarea {
  resize: vertical;
  min-height: 100px;
}

.submit-btn {
  background: #42b983;
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.8rem;
  font-weight: 600;
  justify-content: center;
}

.submit-btn:hover {
  background: #33a06f;
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.submit-btn:active {
  transform: translateY(0);
}

.btn-icon {
  font-size: 1.2rem;
  transition: transform 0.3s ease;
}

.submit-btn:hover .btn-icon {
  transform: translateX(3px);
}

.status-indicator {
  margin-top: 15px;
  color: #67c23a;
  font-weight: bold;
  text-align: center;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .send-notification-container {
    margin: 1rem;
    padding: 1.5rem;
  }

  .title {
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
  }

  .mode-switch {
    flex-direction: column;
  }

  .form-input,
  .form-textarea {
    padding: 0.6rem 0.8rem;
    font-size: 0.9rem;
  }

  .submit-btn {
    padding: 0.8rem 1.5rem;
    font-size: 0.9rem;
    gap: 0.5rem;
  }
}
</style>